---
title: "Untitled"
author: "105071014_??áÊ?èÂ??"
date: "2019/12/11"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(ROCR)
library(PerformanceAnalytics)
library(e1071)
library(caret)
library(gbm)
library(corrplot)
library(ggcorrplot)
library(MASS)
library(rpart)
library(caTools)
library(naivebayes)
library(class)
library(ISLR)
library(glmnet)
library(Hmisc)
library(funModeling)
library(pROC)
library(randomForest)
library(klaR)
library(scales)
library(cluster)
library(factoextra)
library(DataExplorer)
library(ClustOfVar)
library(GGally)
```



```{r, echo=FALSE}
data <- read.csv('./heart.csv')
colnames(rawdata) <- c('age', 'sex', 'cp', 'trestbps', 'chol', 'fbs', 'restecg', 
                    'thalach', 'exang', 'oldpeak', 'slope', 'ca', 'thal', 'target')

# 'age', 'sex', 'chest_pain_type', 'resting_blood_pressure', 'cholesterol',
# 'fasting_blood_sugar', 'rest_ecg', 
# 'max_heart_rate_achieved',
# 'exercise_induced_angina', 'st_depression', 'st_slope', 'num_major_vessels', 
# 'thalassemia', 'target'

data <- data[!data$ca == 4,]
data <- data[!data$thal == 0,]
dim(data)
```

+ **age**: The person's age in years

+ **sex**: The person's sex (male, female)

+ **cp**: The chest pain experienced (typical angina, atypical angina, non-anginal pain, asymptomatic)

+ **trestbps**: The person's resting blood pressure (mm Hg on admission to the hospital)

+ **chol**: The person's cholesterol measurement in mg/dl

+ **fbs**: The person's fasting blood sugar (> 120 mg/dl or not)

+ **restecg**: Resting electrocardiographic measurement (normal, having ST-T wave abnormality, showing probable or definite left ventricular hypertrophy by Estes' criteria)

+ **thalach**: The person's maximum heart rate achieved

+ **exang**: Exercise induced angina (yes, no)

+ **oldpeak**: ST depression induced by exercise relative to rest ('ST' relates to positions on the ECG plot. See more here)

+ **slope**: the slope of the peak exercise ST segment (upsloping, flat, downsloping)

+ **ca**: The number of major vessels (0-3)

+ **thal**: A blood disorder called thalassemia (normal; fixed defect; reversable defect)

+ **target**: Heart disease


```{r, echo=FALSE}
data <- data %>%
    mutate(sex = if_else(sex == 1, 'male', 'female'),
           cp = if_else(cp == 0, 'asymptomatic',
                        if_else(cp == 1, 'atypical angina', 
                                if_else(cp == 2, 'non-anginal pain', 'typical angina'))),
           fbs = if_else(fbs == 0, 'lower than 120mg/ml', 'greater than 120mg/ml'),
           restecg = if_else(restecg == 0, 'left ventricular hypertrophy', 
                             if_else(restecg == 1, 'normal', 'ST-T wave abnormality')),
           exang = if_else(exang == 0, 'no', 'yes'), 
           slope = if_else(slope == 0, 'downsloping',
                           if_else(slope == 1, 'flat', 'upsloping')),
           ca = as.factor(ca),
           thal = if_else(thal == 1, 'fixed defect', 
                          if_else(thal == 2, 'normal', 'reversable defect')),
           target = if_else(target == 0, 'disease', 'no disease')
           ) %>%
    mutate_if(is.character, as.factor) %>% 
    dplyr::select(target, sex, fbs, exang, cp, restecg, slope, ca, thal, everything())
```

```{r, echo=FALSE}
summary(data)
```

```{r, echo=FALSE}
bar_plot <- function(y, x){
    ggplot(data, (aes(x=factor(eval(parse(text=x))), fill=factor(eval(parse(text=y)))))) +
        geom_bar(position='fill') +
        xlab(x) + ylab(y) +
        ggtitle(paste('Bar Chart :', x, '&', y, sep=' ')) +
        labs(fill=y) +
        geom_text(aes(label=..count..), stat='count', position=position_fill(vjust=0.5))
    }
```

```{r, echo=FALSE}
bar_plot('target', 'sex')
bar_plot('target', 'fbs')
bar_plot('target', 'exang')
bar_plot('target', 'cp')
bar_plot('target', 'restecg')
bar_plot('target', 'slope')
bar_plot('target', 'ca')
bar_plot('target', 'thal')
```


